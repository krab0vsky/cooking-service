<h1 class="page-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>

{{#if error}}
    <div class="alert alert-error">
        <strong>–û—à–∏–±–∫–∞:</strong> {{error}}
    </div>
{{/if}}

{{#if message}}
    <div class="alert alert-success">
        <strong>–£—Å–ø–µ—à–Ω–æ:</strong> {{message}}
    </div>
{{/if}}

<div class="users-table-container">
    <table class="users-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>–õ–æ–≥–∏–Ω</th>
                <th>Email</th>
                <th>–ò–º—è</th>
                <th>–†–æ–ª—å</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {{#each users}}
            <tr class="{{#if this.is_banned}}user-banned{{/if}}">
                <td>{{this.id}}</td>
                <td class="user-login">
                    {{this.login}}
                    {{#if this.is_banned}}
                        <span class="banned-badge">(–∑–∞–±–∞–Ω–µ–Ω)</span>
                    {{/if}}
                </td>
                <td>{{this.email}}</td>
                <td>{{this.name}}</td>
                <td class="user-role">
                    {{this.role}}
                    {{#ifEquals this.role "admin"}}
                        <span class="admin-badge">(–∞–¥–º–∏–Ω)</span>
                    {{/ifEquals}}
                </td>
                <td class="user-status">
                    {{#if this.is_banned}}
                        <span class="status-banned">üö´ –ó–∞–±–∞–Ω–µ–Ω</span>
                        {{#if this.ban_reason}}
                            <div class="ban-reason">–ü—Ä–∏—á–∏–Ω–∞: {{this.ban_reason}}</div>
                        {{/if}}
                        {{#if this.banned_at}}
                            <div class="ban-date">–°: <span class="format-date">{{this.banned_at}}</span></div>
                        {{/if}}
                    {{else}}
                        <span class="status-active">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</span>
                    {{/if}}
                </td>
                <td class="user-actions">
                    {{#ifEquals ../user.id this.id}}
                        <span class="current-user">(—ç—Ç–æ –≤—ã)</span>
                    {{else}}
                        {{#if this.is_banned}}
                            <form action="/admin/users/unban/{{this.id}}" method="POST" class="action-form">
                                <button type="submit" class="btn btn-unban"
                                        onclick="return confirm('–†–∞–∑–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{this.login}}?')">
                                    –†–∞–∑–±–∞–Ω–∏—Ç—å
                                </button>
                            </form>
                        {{else}}
                            <div class="action-buttons">
                                <form action="/admin/users/ban/{{this.id}}" method="POST" class="action-form ban-form">
                                    <input type="text" 
                                           name="ban_reason" 
                                           placeholder="–ü—Ä–∏—á–∏–Ω–∞ –±–∞–Ω–∞" 
                                           class="ban-reason-input"
                                           required>
                                    <button type="submit" class="btn btn-ban"
                                            onclick="return confirm('–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{this.login}}?')">
                                        üö´ –ó–∞–±–∞–Ω–∏—Ç—å
                                    </button>
                                </form>
                                
                                <form action="/admin/users/delete/{{this.id}}" method="POST" class="action-form">
                                    <button type="submit" class="btn btn-delete"
                                            onclick="return confirm('–£–î–ê–õ–ò–¢–¨ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{this.login}} –Ω–∞–≤—Å–µ–≥–¥–∞?\\n\\n–í–ù–ò–ú–ê–ù–ò–ï: –í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã, –æ—Ü–µ–Ω–∫–∏ –∏ –æ—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞
                                    </button>
                                </form>
                            </div>
                        {{/if}}
                    {{/ifEquals}}
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

<script>
// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.format-date').forEach(el => {
        if (el.textContent) {
            el.textContent = formatDate(el.textContent);
        }
    });
});
</script>